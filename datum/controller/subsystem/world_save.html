<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/controller/subsystem/world_save - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/controller/subsystem/world_save.html#var">Var Details</a> - <a href="datum/controller/subsystem/world_save.html#proc">Proc Details</a></header><main><h1>world_save <aside>/<a href="datum.html">datum</a>/<a href="datum/controller/subsystem.html">controller/subsystem</a>/<a href="datum/controller/subsystem/world_save.html">world_save</a></aside> <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L4"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 4"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/counted_areas">counted_areas</a></th><td>Areas that have been counted</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/current_save_metrics">current_save_metrics</a></th><td>Tracking variables for save metrics</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/current_save_x">current_save_x</a></th><td>Current x coordinate being processed</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/current_save_y">current_save_y</a></th><td>Current y coordinate being processed</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/current_save_z_level">current_save_z_level</a></th><td>Current z-level being saved</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/map_configs_cache">map_configs_cache</a></th><td>A list of map config jsons used by persistence organized by z-level traits</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/save_in_progress">save_in_progress</a></th><td>Whether a save operation is currently in progress</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#var/was_first_roundstart_autosave_skipped">was_first_roundstart_autosave_skipped</a></th><td>This is used to skip the 1st autosave that is automatically done vis the subsystems fire() at roundstart</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#proc/cache_z_levels_map_configs">cache_z_levels_map_configs</a></th><td>Based on the last recent save, get a list of all z levels as numbers which have the specific trait
Will return null if no traits match or a save file doesn't exist yet</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#proc/get_current_persistence_map_directory">get_current_persistence_map_directory</a></th><td>Returns the path to persistence maps directory based on current timestamp format via YYYY-MM-DD_UTC_hh.mm.ss</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#proc/get_current_progress_percent">get_current_progress_percent</a></th><td>Gets the current progress percentage for the active z-level</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#proc/prune_old_autosaves">prune_old_autosaves</a></th><td>Deletes empty save directories and removes the oldest saves if the total count exceeds the max autosaves allowed in config</td></tr><tr><th><a href="datum/controller/subsystem/world_save.html#proc/save_world">save_world</a></th><td>Saves map z-levels in the world based on PERSISTENT_SAVE_ENABLED config options in config/persistence.txt</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/counted_areas"><aside class="declaration">var </aside>counted_areas <aside>– /list</aside> <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L32"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 32"></a></h3><p>Areas that have been counted</p><h3 id="var/current_save_metrics"><aside class="declaration">var </aside>current_save_metrics <aside>– /list</aside> <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L22"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 22"></a></h3><p>Tracking variables for save metrics</p><h3 id="var/current_save_x"><aside class="declaration">var </aside>current_save_x <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L26"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 26"></a></h3><p>Current x coordinate being processed</p><h3 id="var/current_save_y"><aside class="declaration">var </aside>current_save_y <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L28"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 28"></a></h3><p>Current y coordinate being processed</p><h3 id="var/current_save_z_level"><aside class="declaration">var </aside>current_save_z_level <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L24"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 24"></a></h3><p>Current z-level being saved</p><h3 id="var/map_configs_cache"><aside class="declaration">var </aside>map_configs_cache <aside>– /list</aside> <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L20"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 20"></a></h3><p>A list of map config jsons used by persistence organized by z-level traits</p><h3 id="var/save_in_progress"><aside class="declaration">var </aside>save_in_progress <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L30"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 30"></a></h3><p>Whether a save operation is currently in progress</p><h3 id="var/was_first_roundstart_autosave_skipped"><aside class="declaration">var </aside>was_first_roundstart_autosave_skipped <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L18"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 18"></a></h3><p>This is used to skip the 1st autosave that is automatically done vis the subsystems fire() at roundstart</p><h2 id="proc">Proc Details</h2><h3 id="proc/cache_z_levels_map_configs"><aside class="declaration">proc </aside>cache_z_levels_map_configs<aside>()  <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L160"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 160"></a></aside></h3><p>Based on the last recent save, get a list of all z levels as numbers which have the specific trait
Will return null if no traits match or a save file doesn't exist yet</p><h3 id="proc/get_current_persistence_map_directory"><aside class="declaration">proc </aside>get_current_persistence_map_directory<aside>()  <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L81"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 81"></a></aside></h3><p>Returns the path to persistence maps directory based on current timestamp format via YYYY-MM-DD_UTC_hh.mm.ss</p><h3 id="proc/get_current_progress_percent"><aside class="declaration">proc </aside>get_current_progress_percent<aside>()  <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L414"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 414"></a></aside></h3><p>Gets the current progress percentage for the active z-level</p><h3 id="proc/prune_old_autosaves"><aside class="declaration">proc </aside>prune_old_autosaves<aside>()  <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L103"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 103"></a></aside></h3><p>Deletes empty save directories and removes the oldest saves if the total count exceeds the max autosaves allowed in config</p><h3 id="proc/save_world"><aside class="declaration">proc </aside>save_world<aside>(/list/z_levels, silent)  <a href="https://github.com/tgp-station/tgp-station/blob/0f67d518085748577dfd8d381e48dceb6a56cd44/modular_tgp/persistence/world_save_subsystem.dm#L72"><img src="git.png" width="16" height="16" title="modular_tgp/persistence/world_save_subsystem.dm 72"></a></aside></h3><p>Saves map z-levels in the world based on PERSISTENT_SAVE_ENABLED config options in config/persistence.txt</p></main><footer>tgstation.dme <a href="https://github.com/tgp-station/tgp-station/tree/0f67d518085748577dfd8d381e48dceb6a56cd44">0f67d51</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>